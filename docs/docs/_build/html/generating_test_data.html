<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Creating testing data &#8212; turbustat v1.0.dev2393</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="make_3dfield" href="api/turbustat.simulator.make_3dfield.html" />
    <link rel="prev" title="Wavelet Distance" href="tutorials/metrics/wavelet_example.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          turbustat</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.dev2393</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing TurbuStat</a></li>
<li class="toctree-l1"><a class="reference internal" href="accepted_input_formats.html">Accepted Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="preparing_simulated_data.html">Preparing Simulated Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_requirements.html">Data Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="moments.html">Deriving Cube Moments</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">TurbuStat Tutorials</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating testing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html#distance-metrics">Distance Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to TurbuStat</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Creating testing data</a><ul>
<li><a class="reference internal" href="#two-dimensional-images">Two-dimensional images</a></li>
<li><a class="reference internal" href="#three-dimensional-fields">Three-dimensional fields</a></li>
<li><a class="reference internal" href="#simple-ppv-cubes">Simple PPV cubes</a></li>
<li><a class="reference internal" href="#module-turbustat.simulator">Source Code</a><ul>
<li><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="tutorials/metrics/wavelet_example.html" title="Previous Chapter: Wavelet Distance"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Wavelet Distance</span>
    </a>
  </li>
  <li>
    <a href="api/turbustat.simulator.make_3dfield.html" title="Next Chapter: make_3dfield"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">make_3dfield &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/generating_test_data.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Creating testing data</a><ul>
<li><a class="reference internal" href="#two-dimensional-images">Two-dimensional images</a></li>
<li><a class="reference internal" href="#three-dimensional-fields">Three-dimensional fields</a></li>
<li><a class="reference internal" href="#simple-ppv-cubes">Simple PPV cubes</a></li>
<li><a class="reference internal" href="#module-turbustat.simulator">Source Code</a><ul>
<li><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="creating-testing-data">
<span id="gen-test-data"></span><h1>Creating testing data<a class="headerlink" href="#creating-testing-data" title="Permalink to this headline">¶</a></h1>
<p>TurbuStat includes a simulation package to create 2D images and PPV cubes with
set power-law indices. These provide simple non-realistic synthetic
observations that can be used to test idealized regimes of turbulent statistics.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
</pre></div>
</div>
<div class="section" id="two-dimensional-images">
<h2>Two-dimensional images<a class="headerlink" href="#two-dimensional-images" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>The 2D power-law image function is <code class="xref py py-obj docutils literal notranslate"><span class="pre">make_extended</span></code>::</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">turbustat.simulator</span> <span class="k">import</span> <span class="n">make_extended</span>
</pre></div>
</div>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">make_extended</span></code> function is adapted from the implementation in <a class="reference external" href="https://image-registration.readthedocs.io/en/latest/">image_registration</a>.</p>
<p>To create an isotropic power-law field, or a fractional Brownian Motion (fBM) field, with an index of 3 and size of 256 pixels, we run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rnoise_img</span> <span class="o">=</span> <span class="n">make_extended</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">powerlaw</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rnoise_img</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<img alt="_images/rednoise_slope3_img.png" src="_images/rednoise_slope3_img.png" />
<p>To calculate the power-spectrum and check its index, we need to generate a minimal FITS HDU:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rnoise_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">rnoise_img</span><span class="p">)</span>
</pre></div>
</div>
<p>The FITS header lacks the information to convert to angular or physical scales and is used here to show the minimal working case. See the <a class="reference internal" href="preparing_simulated_data.html#simobs-tutorial"><span class="std std-ref">handling simulated data tutorial</span></a> on how to create usable FITS header for simulated data.</p>
<p>The power-spectrum of the image should give a slope of 3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">turbustat.statistics</span> <span class="k">import</span> <span class="n">PowerSpectrum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pspec</span> <span class="o">=</span> <span class="n">PowerSpectrum</span><span class="p">(</span><span class="n">rnoise_hdu</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pspec</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radial_pspec_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;binsize&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
<span class="gp">... </span>          <span class="n">fit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;weighted_fit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">fit_2D</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>          <span class="n">low_cut</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">))</span>  <span class="c1"># doctest: +SKIP</span>
<span class="go">                            OLS Regression Results</span>
<span class="go">==============================================================================</span>
<span class="go">Dep. Variable:                      y   R-squared:                       1.000</span>
<span class="go">Model:                            OLS   Adj. R-squared:                  1.000</span>
<span class="go">Method:                 Least Squares   F-statistic:                 8.070e+06</span>
<span class="go">Date:                Thu, 21 Jun 2018   Prob (F-statistic):               0.00</span>
<span class="go">Time:                        11:43:47   Log-Likelihood:                 701.40</span>
<span class="go">No. Observations:                 177   AIC:                            -1399.</span>
<span class="go">Df Residuals:                     175   BIC:                            -1392.</span>
<span class="go">Df Model:                           1</span>
<span class="go">Covariance Type:            nonrobust</span>
<span class="go">==============================================================================</span>
<span class="go">                 coef    std err          t      P&gt;|t|      [0.025      0.975]</span>
<span class="go">------------------------------------------------------------------------------</span>
<span class="go">const          0.0032      0.001      3.952      0.000       0.002       0.005</span>
<span class="go">x1            -2.9946      0.001  -2840.850      0.000      -2.997      -2.992</span>
<span class="go">==============================================================================</span>
<span class="go">Omnibus:                      252.943   Durbin-Watson:                   1.077</span>
<span class="go">Prob(Omnibus):                  0.000   Jarque-Bera (JB):            26797.433</span>
<span class="go">Skew:                          -5.963   Prob(JB):                         0.00</span>
<span class="go">Kurtosis:                      62.087   Cond. No.                         4.55</span>
<span class="go">==============================================================================</span>
</pre></div>
</div>
<img alt="_images/rednoise_pspec_slope3.png" src="_images/rednoise_pspec_slope3.png" />
<p>Anisotropic 2D images can also be produced:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rnoise_img</span> <span class="o">=</span> <span class="n">make_extended</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">powerlaw</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rnoise_img</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<img alt="_images/rednoise_slope3_ellip_05_theta_45.png" src="_images/rednoise_slope3_ellip_05_theta_45.png" />
<p>The power-spectrum can then be calculated and fit in 1D and 2D (see <a class="reference internal" href="tutorials/statistics/pspec_example.html#pspec-tutorial"><span class="std std-ref">Spatial Power Spectrum</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pspec</span> <span class="o">=</span> <span class="n">PowerSpectrum</span><span class="p">(</span><span class="n">rnoise_hdu</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pspec</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radial_pspec_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;binsize&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
<span class="gp">... </span>          <span class="n">fit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;weighted_fit&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">fit_2D</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>          <span class="n">low_cut</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">))</span>  <span class="c1"># doctest: +SKIP</span>
<span class="go">                            OLS Regression Results</span>
<span class="go">==============================================================================</span>
<span class="go">Dep. Variable:                      y   R-squared:                       1.000</span>
<span class="go">Model:                            OLS   Adj. R-squared:                  1.000</span>
<span class="go">Method:                 Least Squares   F-statistic:                 1.122e+06</span>
<span class="go">Date:                Wed, 15 Aug 2018   Prob (F-statistic):               0.00</span>
<span class="go">Time:                        14:18:14   Log-Likelihood:                 526.68</span>
<span class="go">No. Observations:                 177   AIC:                            -1049.</span>
<span class="go">Df Residuals:                     175   BIC:                            -1043.</span>
<span class="go">Df Model:                           1</span>
<span class="go">Covariance Type:            nonrobust</span>
<span class="go">==============================================================================</span>
<span class="go">                 coef    std err          t      P&gt;|t|      [0.025      0.975]</span>
<span class="go">------------------------------------------------------------------------------</span>
<span class="go">const          2.7786      0.002   1295.906      0.000       2.774       2.783</span>
<span class="go">x1            -2.9958      0.003  -1059.077      0.000      -3.001      -2.990</span>
<span class="go">==============================================================================</span>
<span class="go">Omnibus:                       35.156   Durbin-Watson:                   2.661</span>
<span class="go">Prob(Omnibus):                  0.000   Jarque-Bera (JB):              334.753</span>
<span class="go">Skew:                           0.205   Prob(JB):                     2.04e-73</span>
<span class="go">Kurtosis:                       9.725   Cond. No.                         4.55</span>
<span class="go">==============================================================================</span>
</pre></div>
</div>
<img alt="_images/rednoise_pspec_slope3_ellip_05_theta_45.png" src="_images/rednoise_pspec_slope3_ellip_05_theta_45.png" />
</div>
<div class="section" id="three-dimensional-fields">
<h2>Three-dimensional fields<a class="headerlink" href="#three-dimensional-fields" title="Permalink to this headline">¶</a></h2>
<p>Three-dimensional power-law fields can also be produced with <code class="xref py py-obj docutils literal notranslate"><span class="pre">make_3dfield</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">turbustat.simulator</span> <span class="k">import</span> <span class="n">make_3dfield</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">threeD_field</span> <span class="o">=</span> <span class="n">make_3dfield</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">powerlaw</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
</pre></div>
</div>
<p>Only isotropic fields can currently be created. Projections of this 3D field
are shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">threeD_field</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">threeD_field</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">threeD_field</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<img alt="_images/rednoise_3D_slope3_projs.png" src="_images/rednoise_3D_slope3_projs.png" />
</div>
<div class="section" id="simple-ppv-cubes">
<h2>Simple PPV cubes<a class="headerlink" href="#simple-ppv-cubes" title="Permalink to this headline">¶</a></h2>
<p>Also included in this module is a simple PPV cube generator. It has many restrictions
and is primarily intended for creating idealized optically-thin 21-cm HI emission
to test turbulent statistics in idealized conditions.</p>
<p>The function to create the cubes is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">turbustat.simulator</span> <span class="k">import</span> <span class="n">make_3dfield</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
</pre></div>
</div>
<p>We need to create 3D velocity and density cubes. For this simple example, we will create
small 32 pixel cubes so this is quick to compute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">velocity</span> <span class="o">=</span> <span class="n">make_3dfield</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">powerlaw</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">randomseed</span><span class="o">=</span><span class="mi">98734</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">density</span> <span class="o">=</span> <span class="n">make_3dfield</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">powerlaw</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="n">randomseed</span><span class="o">=</span><span class="mi">328764</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">3</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<p>Both fields need to have appropriate units.</p>
<p>There is an additional issue for the density field generated from a power-law in that it will contain negative values. There are numerous approaches to account for negative values, including adding the minimum to force all values to be positive or taking the exponential of this field to produce a log-normal field (<a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2002ApJ...566..276B/abstract">Brunt &amp; Heyer 2002</a>, <a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2011ApJ...740..120R/abstract">Roman-Duval et al. 2011</a>). Here we use the approach from <a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2006A&amp;A...452..223O/abstract">Ossenkopf et al. 2006</a>, adding one standard deviation to all values and masking values that remain negative. Each of these approaches will distort the field properties to some extent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">density</span> <span class="o">+=</span> <span class="n">density</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">density</span><span class="p">[</span><span class="n">density</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">3</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<p>To produce a PPV cube from these fields, using the zeroth axis as the line-of-sight:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cube_hdu</span> <span class="o">=</span> <span class="n">make_ppv</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">los_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">T</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">chan_width</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">v_min</span><span class="o">=-</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">v_max</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<p>We will demonstrate the cube properties using <a class="reference external" href="https://spectral-cube.readthedocs.io">spectral-cube</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectral_cube</span> <span class="k">import</span> <span class="n">SpectralCube</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span> <span class="o">=</span> <span class="n">SpectralCube</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cube_hdu</span><span class="p">)</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<p>The zeroth moment, integrated over the velocity axis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span><span class="o">.</span><span class="n">moment0</span><span class="p">()</span><span class="o">.</span><span class="n">quicklook</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<img alt="_images/ppv_mom0.png" src="_images/ppv_mom0.png" />
<p>The velocity centroid map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span><span class="o">.</span><span class="n">moment1</span><span class="p">()</span><span class="o">.</span><span class="n">quicklook</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<img alt="_images/ppv_mom1.png" src="_images/ppv_mom1.png" />
<p>And the mean spectra, averaged over the spatial dimensions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">quicklook</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>  <span class="c1"># doctest: +SKIP</span>
</pre></div>
</div>
<img alt="_images/ppv_mean_spec.png" src="_images/ppv_mean_spec.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">These simulated cubes (and those from other numerical methods) will suffer from “shot noise” due to a finite number of emitting sources along the line of sight. This will lead to deviations of expected behaviours for several statistics, most notably the <a class="reference internal" href="tutorials/statistics/vca_example.html#vca-tutorial"><span class="std std-ref">VCA</span></a> and <a class="reference internal" href="tutorials/statistics/vcs_example.html#vcs-tutorial"><span class="std std-ref">VCS</span></a> methods. See <a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2003MNRAS.342..325E/abstract">Esquivel et al. 2003</a> and <a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2009ApJ...693.1074C/abstract">Chepurnov et al. 2009</a> for thorough explanations of this effect.</p>
</div>
<p>Useful references for making mock-HI cubes include:</p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2002ApJ...566..276B/abstract">Brunt &amp; Heyer 2002</a></p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2003ApJ...593..831M/abstract">Miville-Deschenes et al. 2003</a></p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2003MNRAS.342..325E/abstract">Esquivel et al. 2003</a></p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2006A&amp;A...452..223O/abstract">Ossenkopf et al. 2006</a></p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2009ApJ...693.1074C/abstract">Chepurnov &amp; Lazarian 2009</a></p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/2011ApJ...740..120R/abstract">Roman-Duval et al. 2011</a></p>
</div>
<div class="section" id="module-turbustat.simulator">
<span id="source-code"></span><h2>Source Code<a class="headerlink" href="#module-turbustat.simulator" title="Permalink to this headline">¶</a></h2>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="api/turbustat.simulator.make_3dfield.html#turbustat.simulator.make_3dfield" title="turbustat.simulator.make_3dfield"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_3dfield</span></code></a>(imsize[,&nbsp;powerlaw,&nbsp;amp,&nbsp;…])</td>
<td>Generate a 3D power-law field with a specified index and random phases.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/turbustat.simulator.make_extended.html#turbustat.simulator.make_extended" title="turbustat.simulator.make_extended"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_extended</span></code></a>(imsize[,&nbsp;powerlaw,&nbsp;theta,&nbsp;…])</td>
<td>Generate a 2D power-law image with a specified index and random phases.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/turbustat.simulator.make_ppv.html#turbustat.simulator.make_ppv" title="turbustat.simulator.make_ppv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_ppv</span></code></a>(vel_field,&nbsp;dens_field[,&nbsp;los_axis,&nbsp;…])</td>
<td>Generate a mock, optically-thin HI PPV cube from a given velocity and density field.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, TurbuStat Development Team.<br/>
      Last updated on 13 Feb 2019.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>